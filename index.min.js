let canvas=document.getElementById("mainCanvas"),ctx=canvas.getContext("2d"),FPS_LIMIT=(ctx.fillStyle="white",144),FPS=0,lastTimestamp=0,lastTimestampFPSCounter=0,frameCount=0,PALLETTE_K=1.2,CELL_SCALE=4,CELL_COUNT_X=canvas.width/CELL_SCALE,CELL_COUNT_Y=canvas.height/CELL_SCALE,ALIVE_RATE=.3,fpsCounter=document.getElementById("fpsCounter"),fpsInput=document.getElementById("fpsInput"),acceptFPSButton=document.getElementById("acceptFPSsettingsButton"),fieldWidthInput=document.getElementById("fieldWidthInput"),fieldHeightInput=document.getElementById("fieldHeightInput"),acceptDimensionButton=document.getElementById("acceptDimensionButton"),aliveRateSpan=document.getElementById("aliveRateValue"),aliveRateRange=document.getElementById("aliveRateRange"),RGBToggle=(aliveRateRange.value=ALIVE_RATE,aliveRateSpan.textContent=100*ALIVE_RATE+"%",document.getElementById("RGB-checkbox")),restartButton=document.getElementById("restartButton"),pauseButton=document.getElementById("pauseButton"),continueButton=document.getElementById("continueButton"),removeButton=document.getElementById("removeButton"),genCounter=document.getElementById("genCount"),cells=(console.log("CANVAS DIMENSION ",canvas.width,canvas.height),console.log("CELL DIMENSION ",CELL_COUNT_X,CELL_COUNT_Y),console.log("NUMBER OF CELLS ",CELL_COUNT_X*CELL_COUNT_Y),[]),generationCounter=0,animationID,isPaused=!0,isPalletteON=!1,createColorPalette=()=>{var n=CELL_SCALE,a=[];for(let t=0;t<CELL_COUNT_Y;t++)for(let e=0;e<CELL_COUNT_X;e++){var l=Math.floor(PALLETTE_K*t)*n,i=Math.floor(355-PALLETTE_K*e*n),o=Math.floor(100-PALLETTE_K*t+Math.floor(e/PALLETTE_K-100)*n);a[t*CELL_COUNT_X+e]=`rgb(${l}, ${i}, ${o})`}return a},colorPalette=createColorPalette(),initCells=t=>{cellsArray=[];for(let e=0;e<CELL_COUNT_Y;e++)for(let e=0;e<CELL_COUNT_X;e++)cellsArray.push(Math.random()<t?1:0);return cellsArray},drawCell=(e,t)=>{isPalletteON&&(ctx.fillStyle=colorPalette[t*CELL_COUNT_X+e]),ctx.fillRect(e*CELL_SCALE,t*CELL_SCALE,CELL_SCALE,CELL_SCALE)},drawCells=n=>{ctx.clearRect(0,0,canvas.width,canvas.height);for(let t=0;t<CELL_COUNT_Y;t++)for(let e=0;e<CELL_COUNT_X;e++)n[t*CELL_COUNT_X+e]&&drawCell(e,t)},fpmY=e=>0===e?CELL_COUNT_Y-1:e,fpmX=e=>0===e?CELL_COUNT_X-1:e,fppY=e=>e===CELL_COUNT_Y-1?-1:e,fppX=e=>e===CELL_COUNT_X-1?-1:e,countCellNeighbors=(e,t,n)=>{var a=CELL_COUNT_X;let l=0;return 1===e[fpmY(n)*a+t-a]&&l++,1===e[n*a+fppX(t)+1]&&l++,1===e[fppY(n)*a+t+a]&&l++,1===e[n*a+fpmX(t)-1]&&l++,1===e[fpmY(n)*a+fppX(t)-a+1]&&l++,1===e[fppY(n)*a+fppX(t)+a+1]&&l++,1===e[fppY(n)*a+fpmX(t)+a-1]&&l++,1===e[fpmY(n)*a+fpmX(t)-a-1]&&l++,l},checkCell=(e,t,n)=>{var a=countCellNeighbors(e,t,n);return 3===a||e[n*CELL_COUNT_X+t]&&2===a?1:0},getNewGeneration=n=>{var a=[];for(let t=0;t<CELL_COUNT_Y;t++)for(let e=0;e<CELL_COUNT_X;e++)a[t*CELL_COUNT_X+e]=checkCell(n,e,t);return a},countFPS=e=>{frameCount++,0!==lastTimestampFPSCounter?1e3<e-lastTimestampFPSCounter&&(FPS=frameCount,fpsCounter.innerHTML=FPS,frameCount=0,lastTimestampFPSCounter=e):lastTimestampFPSCounter=e},animate=e=>{e-lastTimestamp>1e3/FPS_LIMIT&&(countFPS(e),lastTimestamp=e,cells=getNewGeneration(cells),drawCells(cells),generationCounter++,genCounter.innerHTML=generationCounter),animationID=requestAnimationFrame(e=>animate(e))},startAnimation=()=>{isPaused&&(animationID=requestAnimationFrame(animate),isPaused=!1)},stopAnimation=()=>{isPaused||(cancelAnimationFrame(animationID),fpsCounter.innerHTML=0,isPaused=!0)},restartAnimation=()=>{generationCounter=0,stopAnimation(),cells=initCells(ALIVE_RATE),startAnimation()},removeAll=()=>{stopAnimation(),cells=initCells(0),generationCounter=0,genCounter.innerHTML=generationCounter,drawCells(cells)},changeColor=e=>{e||(ctx.fillStyle="white"),isPalletteON=e,isPaused&&drawCells(cells)},acceptFPS=()=>{fpsInput.checkValidity()&&fpsInput.value&&(FPS_LIMIT=fpsInput.value,fpsInput.value="",frameCount=0,lastTimestampFPSCounter=0)},drawCellsByMouse=(changeFieldDimension=(e,t)=>{canvas.width=e,canvas.height=t,CELL_COUNT_X=e/CELL_SCALE,CELL_COUNT_Y=t/CELL_SCALE},acceptCanvasDimension=()=>{fieldWidthInput.checkValidity()&&fieldHeightInput.checkValidity()&&fieldWidthInput.value&&fieldHeightInput.value&&(changeFieldDimension(fieldWidthInput.value,fieldHeightInput.value),fieldWidthInput.value="",fieldHeightInput.value="",isPalletteON||(ctx.fillStyle="white"),colorPalette=createColorPalette(),restartAnimation())},e=>{var t,n;e.preventDefault(),1!==e.buttons&&2!==e.buttons||(t=Math.floor(e.offsetX/CELL_SCALE),n=Math.floor(e.offsetY/CELL_SCALE),cells[n*CELL_COUNT_X+t]=1===e.buttons?1:0,isPaused&&drawCell(t,n,1===e.buttons))});canvas.addEventListener("mousedown",e=>drawCellsByMouse(e)),canvas.addEventListener("mousemove",e=>drawCellsByMouse(e)),canvas.addEventListener("contextmenu",e=>e.preventDefault()),RGBToggle.addEventListener("change",e=>changeColor(e.target.checked)),acceptFPSButton.addEventListener("click",()=>acceptFPS()),acceptDimensionButton.addEventListener("click",()=>acceptCanvasDimension()),aliveRateRange.addEventListener("input",e=>{ALIVE_RATE=+e.target.value,aliveRateSpan.innerHTML=parseInt(100*+e.target.value)+"%"}),pauseButton.addEventListener("click",()=>stopAnimation()),continueButton.addEventListener("click",()=>startAnimation()),restartButton.addEventListener("click",()=>restartAnimation()),removeButton.addEventListener("click",()=>removeAll()),cells=initCells(ALIVE_RATE),startAnimation();